<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {# İlan başlığını dinamik olarak ayarla #}
    <title>{{ auction.title }} | Mezsat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .heart-animation {
            animation: heartBeat 0.8s;
        }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        .progress-value {
            height: 100%;
            background-color: #6366f1;
            transition: width 0.3s ease;
        }
        .comment-box {
            transition: all 0.3s ease;
        }
        .comment-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans"  data-owner="{{ auction.owner.username }}">
    <!-- Navbar -->
    {# Navbar içeriği statik kalabilir veya kullanıcı durumuna göre dinamik hale getirilebilir #}
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="/" class="flex items-center">
                            <i class="fas fa-gavel text-indigo-600 text-2xl mr-2"></i>
                            <span class="text-xl font-bold text-gray-900">Mezsat </span>
                        </a>
                    </div>
                </div>
                <div class="hidden md:ml-6 md:flex md:items-center md:space-x-4">
                    <a href="/" class="px-3 py-2 text-gray-700 hover:text-indigo-600 transition">Ana Sayfa</a>
                    <a href="#" class="px-3 py-2 text-gray-700 hover:text-indigo-600 transition">Kategoriler</a>
                    <a href="#" class="px-3 py-2 text-gray-700 hover:text-indigo-600 transition">Nasıl Çalışır?</a>
                    <div id="auth-buttons">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
                <div class="-mr-2 flex items-center md:hidden">
                    <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-indigo-600 focus:outline-none">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Product Detail Section -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- Product Images Gallery -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-6">
                <!-- Main Image -->
                <div class="relative h-96 rounded-lg overflow-hidden">
                    {# Ana resmi dinamik olarak göster #}
                    {% if auction.image %}
                        <img src="{{ auction.image.url }}" alt="{{ auction.title }}" class="w-full h-full object-cover">
                    {% else %}
                        {# Varsayılan bir resim gösterilebilir #}
                        <img src="https://via.placeholder.com/800x600?text=Resim+Yok" alt="{{ auction.title }}" class="w-full h-full object-cover">
                    {% endif %}
                    <button id="favorite-btn" class="absolute top-4 right-4 p-3 bg-white rounded-full shadow-md text-red-500 hover:bg-red-50 transition">
                        {# Favori durumu dinamik olarak ayarlanabilir #}
                        <i class="fas fa-heart text-xl"></i>
                    </button>
                </div>

                <!-- Product Info -->
                <div class="space-y-6">
                    <div>
                        {# İlan başlığını ve kategorisini dinamik olarak göster #}
                        <h1 class="text-3xl font-bold text-gray-900">{{ auction.title }}</h1>
                        <div class="flex items-center mt-2">
                            <span class="text-indigo-600 font-medium">{{ auction.category.name }}</span> {# Kategori modeline göre ayarlayın #}
                        </div>
                    </div>

                    <div class="border-t border-b border-gray-200 py-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm text-gray-500">Mevcut teklif</p>
                                {# Mevcut teklifi dinamik olarak göster #}
                                <p class="text-3xl font-bold text-indigo-600">{{ auction.current_bid.amount|default:"Teklif Yok" }} ₺</p> {# Varsayılan değer eklenebilir #}
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Başlangıç fiyatı</p>
                                {# Başlangıç fiyatını dinamik olarak göster #}
                                <p class="text-xl font-bold text-gray-700">{{ auction.starting_price }} ₺</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Satılık fiyatı</p>
                                {# Hemen Al fiyatını dinamik olarak göster (varsa) #}
                                <p class="text-xl font-bold text-gray-700">{{ auction.buy_now_price|default:"-" }} ₺</p> {# Varsayılan değer eklenebilir #}
                            </div>
                        </div>
                    </div>

                    <!-- Auction Timer -->
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm text-gray-600 mb-1">
                                <span>Kalan süre</span>
                                {# Kalan süreyi dinamik olarak göster (timeuntil filtresi veya özel bir context değişkeni ile) #}
                                <div class="flex gap-2">
                                    <span> {{ time_left }} gün</span>
                                    <span>{{ auction.end_date|timeuntil }}</span> {# Veya daha detaylı formatlama gerekebilir #}

                                </div>
                            </div>
                            <div class="progress-bar">
                                {# İlerleme çubuğu dinamik olarak hesaplanabilir #}
                                <div class="progress-value"style="width: {{ progress_percent|default:"0"|floatformat:0 }}%;"></div> {# Genişlik dinamik olmalı #}
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500">Teklif sayısı</p>
                                {# Teklif sayısını dinamik olarak göster #}
                                <p class="text-lg font-semibold">{{ auction.bids.count }}</p> {# bids ilişkili model yöneticisi varsayıldı #}
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 text-right">İlan Oluşturulma Tarihi</p>
                                
                                <p class="text-lg font-semibold text-right">{{ auction.created_at }}</p> 
                            </div>
                        </div>
                    </div>

                    <!-- Bid Form -->
                    {% if auction.status != "sold" and request.user != auction.owner %}
                    <div id="bid-form-container" class="bg-gray-50 p-4 rounded-lg hidden">
                        <h3 class="text-lg font-medium mb-4">Teklif Ver</h3>
                        <form id="bid-form">
                            <div class="flex space-x-2">
                                <input name="amount" id="bid-amount" type="number" placeholder="Teklif miktarı"
                                    class="flex-1 border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                                <button type="submit"
                                    class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition">
                                    Gönder
                                </button>
                            </div>
                        </form>
                    </div>
                    {% endif %}
<!-- Giriş uyarısı -->
<div id="login-warning" class="bg-yellow-100 p-4 rounded-lg text-center text-yellow-800 hidden">
    Teklif verebilmek için <a href="/login" class="text-indigo-600 underline">giriş yapın</a>.
</div>

                </div>
            </div>

            <!-- Product Details Tabs -->
            <div class="border-t border-gray-200">
                <nav class="flex divide-x divide-gray-200">
                    <button id="description-tab" class="flex-1 py-4 px-6 text-center text-sm font-medium text-indigo-600 bg-indigo-50">Açıklama</button>
                    {# Teklif ve yorum sayılarını dinamik olarak göster #}
                    <button id="bids-tab" class="flex-1 py-4 px-6 text-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50">Teklifler ({{ auction.bids.count }})</button>
                    <button id="comments-tab" class="flex-1 py-4 px-6 text-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50">Yorumlar ({{ auction.comments.count }})</button> {# comments ilişkili model yöneticisi varsayıldı #}
                </nav>

                <!-- Tab Contents -->
                <div class="divide-y divide-gray-200">
                    <!-- Description Content -->
                    <div id="description-content" class="p-6">
                        <h2 class="text-xl font-semibold mb-4">Ürün Açıklaması</h2>
                        {# Açıklamayı dinamik olarak göster, HTML içeriyorsa 'safe' filtresi kullan #}
                        <div class="prose max-w-none text-gray-600">
                            {{ auction.description|safe }}
                        </div>
                    </div>

                    <!-- Bids Content (Hidden by default) -->
                    <div id="bids-content" class="hidden p-6">
                        <h2 class="text-xl font-semibold mb-4">Teklif Geçmişi</h2>
                        <div class="space-y-4">
                            {# Teklifleri döngü ile listele #}
                            {% for bid in auction.bids.all %}
                            
                                <div class="flex items-start p-4 bg-gray-50 rounded-lg" data-bid-id="{{ bid.id }}" data-status="{{ bid.status }}">
                                    <div class="flex-1">
                                        <div class="flex justify-between">
                                            <h4 class="font-medium">{{ bid.user.username }}</h4>
                                            <span class="text-sm text-gray-500">{{ bid.created_at|timesince }} önce</span>
                                        </div>
                                        <p class="text-2xl font-bold text-indigo-600 mt-1">{{ bid.amount }} ₺</p>
                        
                                       <div class="mt-2">
    {% if bid.status == 'rejected' %}
        <span class="inline-block px-3 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
            Reddedildi
        </span>
    {% elif bid.status == 'accepted' %}
        <span class="inline-block px-3 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
            Kabul Edildi
        </span>
    {% elif bid.status == 'cancelled' %}
        <span class="inline-block px-3 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">
            İptal Edildi
        </span>
    {% elif bid.status == 'pending' %}
        <span class="inline-block px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">
            Beklemede
        </span>
    {% endif %}
</div>
{% if current_user == bid.user.username and bid.status == 'pending' %}
    <div class="mt-2">
        <button type="button" class="px-3 py-1 text-sm bg-yellow-500 text-white rounded cancel-bid-btn" data-id="{{ bid.id }}">Teklifi İptal Et</button>
    </div>
{% endif %}
                                    </div>
                                </div>
                           
                        {% empty %}
                            <p class="text-gray-500">Henüz teklif yapılmamış.</p>
                        {% endfor %}
                        </div>
                    </div>

                    <!-- Comments Content (Hidden by default) -->
                    <div id="comments-content" class="hidden p-6">
                        <h2 class="text-xl font-semibold mb-4">Ürün Yorumları</h2>

                        <!-- Comment Form -->
                        {# Yorum formu işlevselliği ayrı bir view/form ile yönetilmeli #}
                        {% if auction.is_active and request.user.is_authenticated %}
                        <div class="mb-8 bg-gray-50 p-4 rounded-lg">
                            <h3 class="text-lg font-medium mb-4">Yorum Yap</h3>
                            <textarea rows="3" class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Yorumunuzu buraya yazın..." id="comment-text" ></textarea>
                            <div class="flex justify-end mt-3">
                                <button id="submit-comment" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition">
                                    Gönder
                                </button>
                            </div>
                        </div>
                        {% else %}
                        <div class="bg-yellow-100 p-4 rounded mb-4">Yorum yapabilmek için <a href="/login" class="underline text-indigo-600">giriş yapın</a>.</div>
                        {% endif %}
                        <!-- Comments List -->
                        <div class="space-y-6">
                            {# Yorumları döngü ile listele #}
                            {% for comment in auction.comments.all %} {# comments ilişkili model yöneticisi varsayıldı #}
                            <div class="comment-box bg-white p-6 rounded-lg shadow-sm">
                                <div class="flex items-start">
                                    {# Kullanıcı profil resmi eklenebilir #}
                                    {# <img src="{{ comment.user.profile.image.url }}" alt="{{ comment.user.username }}" class="h-10 w-10 rounded-full mr-4"> #}
                                    <div class="flex-1">
                                        <div class="flex justify-between">
                                            <h4 class="font-medium">{{ comment.user.username }}</h4> {# user ilişkisi varsayıldı #}
                                            <span class="text-sm text-gray-500">{{ comment.created_at|timesince }} önce</span> {# created_at alanı varsayıldı #}
                                        </div>
                                        <div class="mt-3">
                                            <p class="text-gray-700">{{ comment.text }}</p> {# text alanı varsayıldı #}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <p class="text-gray-500">Henüz yorum yapılmamış.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seller Info -->
            <div class="border-t border-gray-200 p-6">
                <h2 class="text-xl font-semibold mb-4">Satıcı Bilgileri</h2>
                <div class="flex items-start">
                    {# Satıcı profil resmi eklenebilir #}
                    {% if auction.owner.profile_image %}
                    <img src="{{ auction.owner.profile_image.url }}" alt="{{ auction.owner.username }}" class="w-12 h-12 rounded-full mr-3">
                {% else %}
                    <div class="w-12 h-12 rounded-full bg-gray-300 mr-3 flex items-center justify-center">
                        <i class="fas fa-user text-white"></i>
                    </div>
                {% endif %}
                    <div class="flex-1">
                        {# Satıcı adını dinamik olarak göster #}
                        <h3 class="text-lg font-medium  flex items-center mt-2 ">{{ auction.owner.username  }}</h3> 
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Mezsat</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white">Hakkımızda</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Kariyer</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Basın</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Yardım</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white">Sıkça Sorulan Sorular</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Güvenlik</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">İletişim</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Kurallar</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white">Kullanım Koşulları</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Gizlilik Politikası</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">Çerez Politikası</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Bizi Takip Edin</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <div class="mt-4">
                        <p class="text-gray-300">Uygulamayı indirin:</p>
                        <div class="flex space-x-2 mt-2">
                            <a href="#" class="block"><img src="https://via.placeholder.com/120x40?text=App+Store" alt="App Store" class="h-10"></a>
                            <a href="#" class="block"><img src="https://via.placeholder.com/120x40?text=Google+Play" alt="Google Play" class="h-10"></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-12 pt-8 border-t border-gray-700 text-center">
                <p class="text-gray-400">© 2023 Mezsat. Tüm hakları saklıdır.</p>
            </div>
        </div>
    </footer>

    <script>
        const token = localStorage.getItem('access');
        const isLoggedIn = !!token;
        // Tab switching logic
        const descriptionTab = document.getElementById('description-tab');
        const bidsTab = document.getElementById('bids-tab');
        const commentsTab = document.getElementById('comments-tab');
        const descriptionContent = document.getElementById('description-content');
        const bidsContent = document.getElementById('bids-content');
        const commentsContent = document.getElementById('comments-content');
        const currentUsername = localStorage.getItem("username");
        const tabs = [descriptionTab, bidsTab, commentsTab];
        const contents = [descriptionContent, bidsContent, commentsContent];

        document.addEventListener('DOMContentLoaded', function() {
    renderAuthButtons();
    setupLogout();
});
        async function renderAuthButtons() {
                const authButtonsContainer = document.getElementById('auth-buttons');
                // const mobileAuthButtonsContainer = document.getElementById('mobile-auth-buttons');
                const token = localStorage.getItem('access');

                if (token) {
                    try {
                        const response = await fetch('/api/profile/', {
                            headers: {
                                'Authorization': 'Bearer ' + token
                            }
                        });

                        if (!response.ok) throw new Error("Kullanıcı bilgileri alınamadı");

                        const user = await response.json(); // Gerçek kullanıcı

                        const desktopContent = `
                            <div class="flex items-center space-x-4">
                                <div class="relative group">
                                    <button class="flex items-center space-x-1 text-gray-700 hover:text-indigo-600">
                                        <span>${user.username}</span>
                                        <i class="fas fa-chevron-down text-xs"></i>
                                    </button>                                    <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden group-hover:block z-50">
                                        <a href="profile" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Profilim</a>
                                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Favorilerim</a>
                                        <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">İlanlarım</a>
                                        <a href="#" id="logout-btn" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Çıkış Yap</a>
                                    </div>
                                </div>
                                <a href="#" class="px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition">
                                    <i class="fas fa-plus mr-1"></i> İlan Ver
                                </a>
                            </div>
                        `;

                        // const mobileContent = `
                        //     <a href="profile/" class="block px-3 py-2 text-gray-700 hover:text-indigo-600">Profilim</a>
                        //     <a href="#" class="block px-3 py-2 text-gray-700 hover:text-indigo-600">Favorilerim</a>
                        //     <a href="#" class="block px-3 py-2 text-gray-700 hover:text-indigo-600">İlanlarım</a>
                        //     <a href="#" id="mobile-logout-btn" class="block px-3 py-2 text-gray-700 hover:text-indigo-600">Çıkış Yap</a>
                        //     <a href="#" class="block px-3 py-2 mt-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition text-center">
                        //         <i class="fas fa-plus mr-1"></i> İlan Ver
                        //     </a>
                        // `;

                        authButtonsContainer.innerHTML = desktopContent;
                        // mobileAuthButtonsContainer.innerHTML = mobileContent;

                        // Favoriler kısmını göster
                        // document.getElementById('favorites-section').classList.remove('hidden');
                        setupLogout();

                    } catch (err) {
                        console.error("Kullanıcı bilgisi alınamadı:", err);
                        // Token bozuksa giriş yapılmamış gibi göster
                        authButtonsContainer.innerHTML = `<a href="/login/" class="px-3 py-2 text-gray-700 hover:text-indigo-600 transition">Giriş Yap</a>`;
                        // mobileAuthButtonsContainer.innerHTML = `<a href="/login/" class="block px-3 py-2 text-gray-700 hover:text-indigo-600">Giriş Yap</a>`;
                    }
                } else {
                    // Giriş yapılmamışsa
                    authButtonsContainer.innerHTML = `
                        <a href="/login/" class="px-3 py-2 text-gray-700 hover:text-indigo-600 transition">Giriş Yap</a>
                        <a href="/register/" class="px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition">
                        <i class="fas fa-user-plus mr-1"></i> Kayıt Ol
                        </a>
                    `;
                    // mobileAuthButtonsContainer.innerHTML = `
                    //     <a href="/login/" class="block px-3 py-2 text-gray-700 hover:text-indigo-600">Giriş Yap</a>
                    //     <a href="/register/" class="px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition">
                    //     <i class="fas fa-user-plus mr-1"></i> Kayıt Ol
                    //     </a>
                    // `;
                }
        }
        function setupLogout() {
            const logoutBtn = document.getElementById('logout-btn');
            const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('access');
                    localStorage.removeItem('refresh');
                    localStorage.removeItem('username');
                    document.cookie = "access=; Max-Age=0; path=/;";
                    document.cookie = "refresh=; Max-Age=0; path=/;";
                    location.reload();
                    window.location.href = '/';
                });
            }
            
            if (mobileLogoutBtn) {
                mobileLogoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('access');
                    localStorage.removeItem('refresh');
                    localStorage.removeItem('username');
                     document.cookie = "access=; Max-Age=0; path=/;";
                    document.cookie = "refresh=; Max-Age=0; path=/;";
                    location.reload();
                    window.location.href = '/';
                });
            }
        }
        tabs.forEach((tab, index) => {
            tab.addEventListener('click', () => {
                // Reset all tabs and contents
                tabs.forEach(t => {
                    t.classList.remove('text-indigo-600', 'bg-indigo-50');
                    t.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:bg-gray-50');
                });
                contents.forEach(c => c.classList.add('hidden'));

                // Activate clicked tab and content
                tab.classList.add('text-indigo-600', 'bg-indigo-50');
                tab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:bg-gray-50');
                contents[index].classList.remove('hidden');
            });
        });

        // Favorite button animation (example)
        const favoriteBtn = document.getElementById('favorite-btn');
        favoriteBtn.addEventListener('click', () => {
            const icon = favoriteBtn.querySelector('i');
            icon.classList.toggle('text-red-500'); // Toggle color
            icon.classList.toggle('text-gray-400'); // Toggle color
            icon.classList.add('heart-animation');
            setTimeout(() => icon.classList.remove('heart-animation'), 800);
            // Add logic here to actually save/remove favorite via API
        });

        // Mobile menu toggle (example, adjust if needed)
        // ... (Navbar'daki mobil menü script'i buraya da eklenebilir veya merkezi bir JS dosyasından yönetilebilir) ...
    document.addEventListener('DOMContentLoaded', () => {
    const currentUsername = localStorage.getItem("username");
    const auctionOwner = document.body.dataset.owner;
console.log(auctionOwner);
console.log(currentUsername);

    const bidForm = document.querySelector('#bid-submit-button')?.closest('div.bg-gray-50'); // teklif form container'ı
    const acceptRejectArea = document.querySelector('#bids-content'); // teklif geçmişi alanı

    // Eğer kullanıcı kendi ilanına bakıyorsa
    if (currentUsername === auctionOwner) {
        // Teklif verme formunu gizle
        if (bidForm) {
            bidForm.style.display = 'none';
        }

        // Teklif geçmişinde kabul/ret butonları göster
        document.querySelectorAll('#bids-content [data-bid-id]').forEach(bidElement => {
    const bidContainer = bidElement.querySelector('.flex-1');
    const bidId = bidElement.dataset.bidId;
    const bidStatus = bidElement.dataset.status;

if (auctionOwner === currentUsername && bidStatus === 'pending') {
    const controls = document.createElement('div');
    controls.className = "mt-2 flex gap-2";
    controls.innerHTML = `
        <button type="button" class="px-3 py-1 text-sm bg-green-500 text-white rounded accept-btn" data-id="${bidId}">Kabul Et</button>
        <button type="button" class="px-3 py-1 text-sm bg-red-500 text-white rounded reject-btn" data-id="${bidId}">Reddet</button>
    `;
    bidContainer.appendChild(controls);
}
});
    } else {
        // Kendi ilanı değilse teklifleri yönetmesin
        document.querySelectorAll('.accept-btn, .reject-btn').forEach(btn => btn.remove());
    }

    // Kabul / Reddet işlemleri
    document.addEventListener('click', async e => {
        if (e.target.classList.contains('accept-btn') || e.target.classList.contains('reject-btn')) {
            e.preventDefault();
            const bidId = e.target.dataset.id;
            const isAccept = e.target.classList.contains('accept-btn');
            const url = isAccept 
                ? `/api/bids/${bidId}/accept/` 
                : `/api/bids/${bidId}/reject/`;
            const token = localStorage.getItem("access");
            console.log(token);
            const response = await fetch(url, {
                method: 'POST',
                headers:{
                    'Authorization': 'Bearer ' + token
                }
            });

            if (response.ok) {
                alert(isAccept ? "Teklif kabul edildi." : "Teklif reddedildi.");
                location.reload();
            } else {
                const result = await response.json();
                alert(result.detail || "Bir hata oluştu.");
            }
        }
    });
});
document.addEventListener('DOMContentLoaded', async () => {
    const token = localStorage.getItem("access");
    const currentUsername = localStorage.getItem("username");
    const auctionOwner = document.body.dataset.owner;

    const bidFormContainer = document.getElementById('bid-form-container');
    const loginWarning = document.getElementById('login-warning');

    if (!token) {
        loginWarning.classList.remove('hidden'); // Giriş yap uyarısı göster
    } else if (currentUsername === auctionOwner) {
        // Kendi ilanıysa hiçbir şey gösterme
    } else {
        bidFormContainer.classList.remove('hidden'); // Teklif formunu göster
    }

    // Teklif gönderme işlemi
    const bidForm = document.getElementById('bid-form');
bidForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const amount = parseFloat(document.getElementById('bid-amount').value);
    console.log("Gönderilecek amount:", amount);  // 🐞 burada kontrol et
    if (!amount || isNaN(amount)) {
        alert("Lütfen geçerli bir teklif girin.");
        return;
    }

    const auctionId = window.location.pathname.split('/').filter(Boolean).pop();
    const token = localStorage.getItem("access");

    try {
        const response = await fetch(`/api/auctions/${auctionId}/bids/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ amount: amount })
        });

        if (response.ok) {
            alert("Teklif başarıyla gönderildi.");
            window.location.reload();
        } else {
            const result = await response.json();
            console.error("Hata:", result);
            alert(result.detail || "Teklif gönderilemedi.");
        }
    } catch (err) {
        console.error("İstek hatası:", err);
        alert("Sunucuya ulaşılamadı.");
    }
});
});
document.addEventListener('click', async function(e) {
    if (e.target.classList.contains('cancel-bid-btn')) {
        const bidId = e.target.dataset.id;
        const token = localStorage.getItem("access");

        const confirmCancel = confirm("Bu teklifi iptal etmek istediğinizden emin misiniz?");
        if (!confirmCancel) return;

        try {
            const response = await fetch(`/api/auctions/bids/${bidId}/cancel/`, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });

            const data = await response.json();

            if (response.ok) {
                alert("Teklif iptal edildi.");
                location.reload();
            } else {
                alert(data.detail || "İptal işlemi başarısız.");
            }
        } catch (err) {
            alert("Sunucuya ulaşılamadı.");
        }
    }
});

document.getElementById('submit-comment').addEventListener('click', async () => {
    const token = localStorage.getItem("access");
    const comment = document.getElementById('comment-text').value.trim();
    const auctionId = window.location.pathname.split('/').filter(Boolean).pop();

    if (!comment) {
        alert("Yorum boş olamaz.");
        return;
    }

    try {
        const response = await fetch(`/api/auctions/${auctionId}/comments/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ text: comment })
        });

        if (response.ok) {
            alert("Yorum gönderildi.");
            location.reload();
        } else {
            const result = await response.json();
            alert(result.detail || "Yorum gönderilemedi.");
        }
    } catch (err) {
        alert("Sunucuya ulaşılamadı.");
        console.error(err);
    }
});

document.addEventListener('DOMContentLoaded', function() {
            renderAuthButtons();
            setupLogout();
        });


        
    </script>
</body>
</html>
